# 統合管理ポータル要件定義

**作成者**: kuma8088（AWS認定ソリューションアーキテクト、ITストラテジスト）
**技術スタック**: FastAPI, React, TypeScript, Tailwind CSS, Docker Compose

---

## 1. プロジェクト背景と目的

### 1.1 解決すべき課題

| 課題 | 詳細 | 影響 |
|-----|------|------|
| 管理画面分散 | Flask usermgmt、Cloudflare Web UI、各種CLI | 運用効率低下 |
| 操作の煩雑さ | 複数システム切り替え | 操作ミスのリスク |
| 監視・ログ未統一 | システムごとに異なるログ確認方法 | 障害対応遅延 |
| UI/UX旧式 | Flask usermgmtは機能的だが古いデザイン | ユーザビリティ低下 |

### 1.2 プロジェクト目標

1. **統一管理** - Blog System + Mailserver + Cloudflare DNSを一元管理
2. **運用効率化** - 運用時間50%削減目標
3. **モダンUI/UX** - Xserver風の直感的なインターフェース
4. **監視統合** - リアルタイム監視とアラート機能

---

## 2. 機能要件

### 2.1 Dashboard（ダッシュボード）

| 要件ID | 要件 | 優先度 | 状況 |
|--------|-----|--------|------|
| DASH-001 | システム全体の健全性表示 | 必須 | UI完成 |
| DASH-002 | リソース使用状況（CPU, RAM, ディスク） | 必須 | UI完成 |
| DASH-003 | サービスステータス一覧 | 必須 | UI完成 |
| DASH-004 | 最近のアクティビティ表示 | 推奨 | UI完成 |
| DASH-005 | アラート通知表示 | 推奨 | UI完成 |

### 2.2 Domain Management（ドメイン管理）

| 要件ID | 要件 | 優先度 | 状況 |
|--------|-----|--------|------|
| DNS-001 | Cloudflareゾーン一覧表示 | 必須 | ✅ 完了 |
| DNS-002 | DNSレコードCRUD操作 | 必須 | ✅ 完了 |
| DNS-003 | Cloudflareプロキシ設定 | 必須 | ✅ 完了 |
| DNS-004 | TTL設定 | 必須 | ✅ 完了 |
| DNS-005 | DNSレコード編集 | 推奨 | 計画中 |
| DNS-006 | バルク操作（一括削除、CSV） | 推奨 | 計画中 |

### 2.3 Docker Management（Docker管理）

| 要件ID | 要件 | 優先度 | 状況 |
|--------|-----|--------|------|
| DOCK-001 | コンテナ一覧表示 | 必須 | UI完成 |
| DOCK-002 | コンテナ起動/停止/再起動 | 必須 | API待ち |
| DOCK-003 | リアルタイムログ表示 | 必須 | API待ち |
| DOCK-004 | リソース使用状況表示 | 推奨 | API待ち |
| DOCK-005 | イメージ管理 | 推奨 | API待ち |

### 2.4 WordPress Management（WordPress管理）

| 要件ID | 要件 | 優先度 | 状況 |
|--------|-----|--------|------|
| WP-001 | 16サイト一覧表示 | 必須 | UI完成 |
| WP-002 | 新規サイト作成ウィザード | 必須 | API待ち |
| WP-003 | サイト設定編集 | 必須 | API待ち |
| WP-004 | プラグイン/テーマ管理 | 推奨 | API待ち |
| WP-005 | WP Mail SMTP一括設定 | 推奨 | API待ち |

### 2.5 Database Management（データベース管理）

| 要件ID | 要件 | 優先度 | 状況 |
|--------|-----|--------|------|
| DB-001 | データベース一覧表示 | 必須 | UI完成 |
| DB-002 | 新規データベース作成 | 必須 | API待ち |
| DB-003 | ユーザー管理 | 必須 | API待ち |
| DB-004 | SQLクエリ実行（制限付き） | 推奨 | API待ち |
| DB-005 | エクスポート/インポート | 推奨 | API待ち |

### 2.6 Mailserver Management（メール管理）

| 要件ID | 要件 | 優先度 | 状況 |
|--------|-----|--------|------|
| MAIL-001 | メールユーザーCRUD | 必須 | 計画中 |
| MAIL-002 | メールドメイン管理 | 必須 | 計画中 |
| MAIL-003 | 監査ログ表示 | 必須 | 計画中 |
| MAIL-004 | 既存Flask usermgmtとの互換性 | 必須 | 計画中 |

### 2.7 Backup Management（バックアップ管理）

| 要件ID | 要件 | 優先度 | 状況 |
|--------|-----|--------|------|
| BK-001 | バックアップ一覧表示 | 必須 | UI完成 |
| BK-002 | 手動バックアップ実行 | 必須 | API待ち |
| BK-003 | リストア操作 | 必須 | API待ち |
| BK-004 | S3同期状況表示 | 推奨 | API待ち |
| BK-005 | スケジュール設定UI | 推奨 | API待ち |

### 2.8 Security Management（セキュリティ管理）

| 要件ID | 要件 | 優先度 | 状況 |
|--------|-----|--------|------|
| SEC-001 | セキュリティスコア表示 | 推奨 | UI完成 |
| SEC-002 | 脆弱性チェック | 推奨 | API待ち |
| SEC-003 | SSL証明書ステータス | 推奨 | API待ち |
| SEC-004 | セキュリティヘッダー確認 | 推奨 | API待ち |

---

## 3. 非機能要件

### 3.1 パフォーマンス

| カテゴリ | 要件 | 目標値 |
|---------|-----|--------|
| API応答 | レスポンスタイム | 平均 < 500ms |
| API応答 | 95パーセンタイル | < 1000ms |
| UI | 初回ページロード | < 3秒 |
| UI | キャッシュ後ロード | < 1秒 |
| 同時接続 | 同時ユーザー数 | 10ユーザー |

### 3.2 セキュリティ

| 項目 | 要件 |
|------|------|
| 認証 | JWT（HS256、有効期限15分） |
| 通信 | HTTPS必須（Cloudflare Tunnel経由） |
| CORS | フロントエンドドメインのみ許可 |
| SQL対策 | パラメータ化クエリ徹底 |
| XSS対策 | 入力値サニタイズ、CSP設定 |
| パスワード | 管理者: bcrypt、メールユーザー: SHA512-CRYPT |

### 3.3 可用性

| 指標 | 目標 |
|------|------|
| システム稼働率 | 99.9%（月間43分以内） |
| バックアップ | 日次自動（AM 3:00） |
| RTO | 1時間以内 |
| RPO | 24時間以内 |

### 3.4 保守性

| 項目 | 目標 |
|------|------|
| テストカバレッジ | 80%以上 |
| ドキュメント | 全API、全機能 |
| ログレベル | INFO（本番）、DEBUG（開発） |

---

## 4. 制約事項

### 4.1 既存システムへの影響

| 制約 | 詳細 |
|------|------|
| 既存usermgmt | services/mailserver/usermgmt/ を変更しない |
| 並行稼働 | Flask usermgmtと同時稼働可能 |
| データベース | 既存テーブル構造を変更しない |

### 4.2 環境制約

| 制約 | 詳細 |
|------|------|
| 実行環境 | Dell WorkStation（Rocky Linux 9.6） |
| ネットワーク | Docker内部ネットワーク（172.20.x.x） |
| リソース | RAM 32GB、既存サービスとリソース共有 |

---

## 5. トレードオフ分析

### 5.1 フロントエンドフレームワーク選択

| 選択肢 | メリット | デメリット | 採用 |
|-------|---------|-----------|------|
| **React + TypeScript** | エコシステム充実、型安全 | 学習コスト | ✓ |
| Vue.js | 学習容易 | エコシステムがReactより小さい | × |
| Angular | 企業向け機能充実 | 過剰な複雑性 | × |

### 5.2 バックエンドフレームワーク選択

| 選択肢 | メリット | デメリット | 採用 |
|-------|---------|-----------|------|
| **FastAPI** | 高速、自動ドキュメント、非同期対応 | 比較的新しい | ✓ |
| Flask | シンプル、既存usermgmtと同じ | 型ヒント弱い | × |
| Django | フル機能 | 過剰な複雑性 | × |

### 5.3 UIフレームワーク選択

| 選択肢 | メリット | デメリット | 採用 |
|-------|---------|-----------|------|
| **Tailwind + shadcn/ui** | カスタマイズ性、モダン | 設定必要 | ✓ |
| Material-UI | 豊富なコンポーネント | 重い、カスタマイズ困難 | × |
| Chakra UI | 使いやすい | コンポーネント数が少ない | × |

**判断根拠**:
- FastAPI: 自動APIドキュメント生成（OpenAPI）が運用に有利
- React: 既存のスキルセットとエコシステムの充実度
- shadcn/ui: Xserver風UIの実現に適したカスタマイズ性

---

## 6. 実装フェーズ

### Phase 1: 基盤構築（✅ 完了）

- FastAPI バックエンド基盤
- React フロントエンド基盤
- Cloudflare DNS API統合
- 8つの管理ページUI実装

### Phase 2: API統合（計画中）

- Docker API統合
- WordPress REST API統合
- MariaDB管理API
- バックアップAPI

### Phase 3: 高度な機能（計画中）

- JWT認証システム
- WebSocketリアルタイム更新
- Mailserverユーザー管理統合
- 監視・アラート機能

### Phase 4: 本番デプロイ（計画中）

- Docker Compose本番設定
- Nginx リバースプロキシ
- CloudWatch統合
- 本番環境デプロイ

---

## 7. 関連ドキュメント

| ドキュメント | 内容 |
|------------|------|
| [architecture.md](architecture.md) | システムアーキテクチャ・コンポーネント設計 |
| [deployment.md](deployment.md) | デプロイ戦略・Docker Compose設定 |
| [operations.md](operations.md) | 運用設計・監視・開発ガイド |
